#Nmap 
## Ports:
Windows NETBIOS - Port 139
SMB - Port 445

## Switches:
`-sS` - Syn scan
`-sU` - UDP scan
`-O` - OS detection
`-sV` - Detect the version of services
`-v` - Increase verbosity
`-vv` - Verbosity level 2
`-oA` - Output in the 3 major formats at once
`-oN` - Save results in normal format
`-oG` - Save results in graphable format
`-A` - Aggressive mode, for detecting os, traceroute, version and common script scanning
`-T<0-5>` - Scan speed (higher is faster)
`-p <port ranges>` - Scan specific ports
`-p-` - Scan all ports
`-sn` - Not scanning any ports, only sends ICMP packets to search for open hosts, or ARP request if on the local network and sudo or root

TCP connect scan - scans using the 3 way handshake
SYN scan (stealth scan) - Returns RST at the end instead of ACK
UDP scan - gets a response if the port is closed, usually not when it's open in which case the port will be tagged as open|filtered

Null scan(`-sN`) - TCP request with no flags, the server will respond with RST if the port is closed
FIN scan(`-sF`) - A TCP request with only the FIN flag, the server will respond with RST if the port is closed
xmas scan(`-sX`) - A TCP request with the flags PSH, URG and FIN, the server will respond with RST if the port is closed
Those 3 scans are affective for when the firewall blocks TCP request with the SYN flag set, although some systems returns RST flags for both open and closed ports, also most modern IDS solutions know to detect this kind of scans

## NSE(Nmap scripting engine):
Written in Lua, used for a variety of thing from scanning for vulnerabilities to automating exploits for them

Some categories:
- safe - Won't affect the target
- Intrusive - Not safe, likely to affect the target
- vuln - Scan for vulnerablilities
- exploit - Attempt to exploit a vulnerability
- auth - Attempt to bypass authentication for running services
- brute - Attempt to brute force credentials for running serveices
- discovery - Attempt to query running services for further information about the network
[More exhaustive list](https://nmap.org/book/nse-usage.html)

`--script=<category>` - Run a script category
`--script=<script-name>` - Run a specific script
`nmap -p 80 --script http-put --script-args http-put.url='/dav/shell.php',http-put.file='./shell.php'` - Example of running a script with arguments

There is an official [website](https://nmap.org/nsedoc/) with all the scripts
`/usr/share/nmap/scripts/script.db` - A file for searching installed scripts
`ls -l /usr/share/nmap/scripts/*ftp*` - Example of using ls instead of grep for searching scripts

Adding uninstalled script:
1. `sudo apt update && sudo apt install nmap`
2. `sudo wget -O /usr/share/nmap/scripts/<script-name>.nse https://svn.nmap.org/nmap/scripts/<script-name>.nse`
3. `nmap --script-updatedb` - Updates the script.db file

## Firewall evasion:
Most firewalls block ICMP requests

`-Pn` - Tells Nmap to not bother pinging hosts, can cause the scan to be long
`-f` - Fragments the packets
`--mtu <number>` - Accepts a maximum transmission unit size, must be a multiple of 8
`--scan-delay <time>ms` - Adds a delay between packets sent, useful for unstable network or to avoid time based firewall/IDS
`--badsum` - Used to generate invalid checksum for packets, any real TCP/IP stack would drop the packet, but firewalls might respond without checking the checksum which can be used to determine the presence of firewall/IDS

