#ActiveDirectory #Kerberos #Windows 

## Windows domains

**Windows domain:** A group of users and computers under the administration of a given business

**Active Directory:** repository that centralizes the administration of common components of windows computer network

**Domain controller:** The server that runs the active directory service

## Active Directory

**Active Directory Domain Service:** A service that acts as a catalogue that holds information of all objects such as users and shares

**Service users:** Only have the permissions required to run the service

**Machine accounts:** Named the computer name followed by a $

|   |   |
|---|---|
|**Security Group**|**Description**|
|Domain Admins|Users of this group have administrative privileges over the entire domain. By default, they can administer any computer on the domain, including the DCs.|
|Server Operators|Users in this group can administer Domain Controllers. They cannot change any administrative group memberships.|
|Backup Operators|Users in this group are allowed to access any file, ignoring their permissions. They are used to perform backups of data on computers.|
|Account Operators|Users in this group can create or modify other accounts in the domain.|
|Domain Users|Includes all existing user accounts in the domain.|
|Domain Computers|Includes all existing computers in the domain.|
|Domain Controllers|Includes all existing DCs on the domain.|

**Organizational Units:** Used to define set of users with similar policing requirements, each user can be in only one OU

**Security Groups:** For granting permission over resources

**Group Policy Objects:** Collection of settings that can be applied to OUs

`SYSVOL` - Share to distribute GPOs

`gpupdate /force` - Force a computer to sync GPOs immediately

## Authentication methods

**Kerberos:** Default in any recent domain, using tickets

**NetNTLM:** Kept for compatibility purposes

### Kerberos authentication steps

1. The user sends their username and timesteps encrypted by a key derived from the password to the Key Distribution Center (KDC), which is in charge of creating tickets, which than will send a Ticket Granting Ticket(TGT) for requesting tickets for services with a session key to generate the following requests, the TGT is encrypted using the krbtgt account
2. The user will than send their username and a timestamp encrypted using the session key along with TGT and Service Principal Name(SPN) to the KDC when they want to access a specific service to get a Ticket Granting Service(TGS), the server will than send the TGS encrypted using a key derived from the Service Owner Hash along with a Service Session Key
3. The TGS can be sent to the desired service, which will decrypt the TGS using its configured account's password hash and will validate the Service Session Key

### NetNTLM authentication steps

1. Authentication request to the server the client wants to access
2. The server sends a randomly generated number as a challenge to the client
3. The client combines their NTLM password hash with the challenge and other known details, and sends it back to the server for verification
4. The server forwards the challenge and response to the DC (when using a domain account)
5. The server recalculates the response using the challenge, the client is authenticated if the responses match, the result is sent back to the server
6. The server forwards the authentication results to the client

## Trees, Forests and trusts

**Tree:** Grouping different domains with the same namespace

**Forest:** Union of different trees to the same network

**one-way trust relationship:** One domain trusts another domain, which lets the trusted domain to authorise user from this domain to access resources from the trusting domain (The resources that are authorised in the trust)

**Two-way trust relationship:** 2 domains that trust each other, formed by default